<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>expandedimage.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.7.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.7.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/bundary.html">bundary</a></li>
            
                <li><a href="..&#x2F;classes/filter.html">filter</a></li>
            
                <li><a href="..&#x2F;classes/processing.html">processing</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: expandedimage.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
jQuery(function($) {

    &#x2F;**
     * 空間フィルタの境界処理を提供する
     *
     * @class bundary
     *&#x2F;
    var boundary = {};

    &#x2F;&#x2F; boundary
    (function() {

        &#x2F;**
         * 境界処理
         *
         * 境界で近傍のピクセルがないときは対角のピクセルを処理する。そのためのカウンタを返す
         * 境界処理は左上端, 左下端, 右上端, 右下端, 左端、右端、上端、下端で処理を分ける。
         *
         * @method expandedIndex
         * @param {Number} k 注目ピクセルのRGBAのRed値インデックス
         * @param {Number} i 空間フィルタの行方向カウンタ
         * @param {Number} j 空間フィルタの列方向カウンタ
         * @return {Object}
         *
         *&#x2F;
        function expandedIndex(k, i, j) {

            &#x2F;&#x2F; imageData.data配列の長さ
            var length = imageData.width * imageData.height * 4;

            &#x2F;&#x2F; 左上端
            if (k === 0) {
                if (i === -1 &amp;&amp; j === -1) {
                    return {
                        i: -i,
                        j: -j
                    };
                }
                if (i === -1 &amp;&amp; j === 0) {
                    return {
                        i: -i,
                        j: j
                    };
                }
                if (i === -1 &amp;&amp; j === 1) {
                    return {
                        i: -i,
                        j: j
                    };
                }
                if (i === 0 &amp;&amp; j === -1) {
                    return {
                        i: i,
                        j: -j
                    };
                }
                if (i === 1 &amp;&amp; j === -1) {
                    return {
                        i: i,
                        j: -j
                    };
                }
                &#x2F;&#x2F; 境界じゃないのでそのまま返す
                return {
                    i: i,
                    j: j
                };
            }
            &#x2F;&#x2F; 左下端
            if (k === (length - imageData.width * 4)) {
                if (i === -1 &amp;&amp; j === -1) {
                    return {
                        i: i,
                        j: -j
                    };
                }
                if (i === 0 &amp;&amp; j === -1) {
                    return {
                        i: i,
                        j: -j
                    };
                }
                if (i === 1 &amp;&amp; j === -1) {
                    return {
                        i: -i,
                        j: -j
                    };
                }
                if (i === 1 &amp;&amp; j === 0) {
                    return {
                        i: -i,
                        j: j
                    };
                }
                if (i === 1 &amp;&amp; j === 1) {
                    return {
                        i: -i,
                        j: j
                    };
                }
                &#x2F;&#x2F; 境界じゃないのでそのまま返す
                return {
                    i: i,
                    j: j
                };
            }
            &#x2F;&#x2F; 右上端
            if (k === (imageData.width - 1) * 4) {
                if (i === -1 &amp;&amp; j === -1) {
                    return {
                        i: -i,
                        j: j
                    };
                }
                if (i === -1 &amp;&amp; j === 0) {
                    return {
                        i: -i,
                        j: j
                    };
                }
                if (i === -1 &amp;&amp; j === 1) {
                    return {
                        i: -i,
                        j: -j
                    };
                }
                if (i === 0 &amp;&amp; j === 1) {
                    return {
                        i: i,
                        j: -j
                    };
                }
                if (i === 1 &amp;&amp; j === 1) {
                    return {
                        i: i,
                        j: -j
                    };
                }
                return {
                    i: i,
                    j: j
                };
            }
            &#x2F;&#x2F; 右下端
            if (k === length - 4) {
                if (i === -1 &amp;&amp; j === 1) {

                    return {
                        i: i,
                        j: -j
                    };
                }
                if (i === 0 &amp;&amp; j === 1) {
                    return {
                        i: i,
                        j: -j
                    };
                }
                if (i === 1 &amp;&amp; j === -1) {
                    return {
                        i: -i,
                        j: j
                    };
                }
                if (i === 1 &amp;&amp; j === 0) {
                    return {
                        i: -i,
                        j: j
                    };
                }
                if (i === 1 &amp;&amp; j === 1) {
                    return {
                        i: -i,
                        j: -j
                    };
                }
                &#x2F;&#x2F; 境界じゃないのでそのまま返す
                return {
                    i: i,
                    j: j
                };
            }
            &#x2F;&#x2F; 左端
            if (k % (imageData.width * 4) === 0) {
                if (j === -1) {
                    return {
                        i: i,
                        j: -j
                    };
                }
                return {
                    i: i,
                    j: j
                };
            }
            &#x2F;&#x2F; 右端
            if (((length -4)- k) % imageData.width * 4 === 0) {
                if (j === 1) {
                    return {
                        i: i,
                        j: -j
                    };
                }
                return {
                    i: i,
                    j: j
                };
            }
            &#x2F;&#x2F; 上端
            if (k &lt; imageData.width * 4) {
                if (i === -1) {
                    return {
                        i: -i,
                        j: j
                    };
                }
                return {
                    i: i,
                    j: j
                };
            }
            &#x2F;&#x2F; 下端
            if (k &gt; (length - 1) - imageData.width * 4) {
                if (i === 1) {
                    return {
                        i: -i,
                        j: j
                    };
                }
                return {
                    i: i,
                    j: j
                };
            }

            &#x2F;&#x2F; 境界ではないのでインデックス変わらない
            return {
                i: i,
                j: j
            };
        }

        boundary.expandedIndex = expandedIndex;

    }());

    &#x2F;**
     * フィルター処理を提供する
     * @class filter
     *&#x2F;
    var filter = {};

    (function() {

        &#x2F;&#x2F; 空間フィルター(3x3)の基本例
        function spatial(k) {
            var i, j, n, index = {}, rgba = {};
            &#x2F;&#x2F; 境界は走査しない
            for (i = -1; i &lt;= 1; i++) {
                for (j = -1; j &lt;= 1; j++) {
                    index = boundary.expandedIndex(k, i, j);
                    n = k + (index.i * 3 + index.j) * 4;
                    rgba.r = imageData.data[n];      &#x2F;&#x2F; Red
                    rgba.g =  imageData.data[n + 1]; &#x2F;&#x2F; Green
                    rgba.b =  imageData.data[n + 2]; &#x2F;&#x2F; Blue
                    rgba.a = imageData.data[n + 3];  &#x2F;&#x2F; Alpha
                }
            }
            return rgba;
        }

        &#x2F;**
         * 2値画像フィルター
         *
         * 注目ピクセルの近傍を使わないフィルター。
         *
         * @method mono
         * @private
         * @param {Number} k 注目ピクセルのRed値に対応するImageData.dataのインデックス&lt;br&gt;
         *     green k + 1&lt;br&gt;
         *     blue  k + 2&lt;br&gt;
         *     alpha k + 3
         * @param {ImageObject} imageData
         * @return {Object} rgbaの値を格納したオブジェクト
         *&#x2F;
        function mono(k, imageData) {
            var rgba = {};
            var color = parseInt((imageData.data[k] + imageData.data[k + 1] + imageData.data[k + 2]) &#x2F; 3, 10);
            color = (color &lt; 128) ? 0 : 255;
            rgba.r = rgba.g = rgba.b = color;
            rgba.a = imageData.data[k + 3];
            return rgba;

        }

        &#x2F;**
         * グレースケール
         *
         * 注目ピクセルの近傍を使わないフィルター。
         *
         * @method grayscale
         * @private
         * @param {Number} k 注目ピクセルのRed値に対応するImageData.dataのインデックス&lt;br&gt;
         *     green k + 1&lt;br&gt;
         *     blue  k + 2&lt;br&gt;
         *     alpha k + 3
         * @param {ImageData} imageData
         * @return {Object} rgbaの値を格納したオブジェクト
         *&#x2F;
        function grayscale(k, imageData) {
            var rgba = {};
            var color = parseInt((imageData.data[k] + imageData.data[k + 1] + imageData.data[k + 2]) &#x2F; 3, 10);
            rgba.r = rgba.g = rgba.b = color;
            rgba.a = imageData.data[k + 3];
            return rgba;
        }

        &#x2F;**
         * 平滑化
         *
         * 注目ピクセルの近傍(3x3)を使う空間フィルター。
         * @method smooth
         * @private
         * @param {Number} k 注目ピクセルのRed値に対応するImageData.dataのインデックス&lt;br&gt;
         *     green k + 1&lt;br&gt;
         *     blue k + 2&lt;br&gt;
         *     alpha k + 3
         * @param {ImageObject} imageData
         * @return {Object} rgbaの値を格納したオブジェクト
         *&#x2F;
        function smooth(k, imageData) {
            var rgba = {};
            var i, j, n, sumRed, sumGreen, sumBlue, index = {};
            sumRed = sumGreen = sumBlue = 0;
            for (i = -1; i &lt;= 1; i++) {
                for (j = -1; j &lt;= 1; j++) {
                    index = boundary.expandedIndex(k, i, j);
                    n = k + (index.i * 3 + index.j) * 4;
                    sumRed += imageData.data[n];
                    sumGreen += imageData.data[n + 1];
                    sumBlue += imageData.data[n + 2];
                }
            }
            rgba.r = Math.floor(sumRed &#x2F; 9);    &#x2F;&#x2F; R
            rgba.g = Math.floor(sumGreen &#x2F; 9);  &#x2F;&#x2F; G
            rgba.b = Math.floor(sumBlue &#x2F; 9);   &#x2F;&#x2F; B
            rgba.a = imageData.data[k + 3]; &#x2F;&#x2F; alpha
            return rgba;
        }

        &#x2F;**
         * フィルタ呼び出し処理
         * @method process
         * @private
         * @param {String} type フィルタ名
         * @param {Number} k ImageData.dataの処理rgbaのred値に対応するインデックス&lt;br&gt;
         * @param {ImageData} imageData
         * @return {Object} rgbaの値を格納したオブジェクト
         *&#x2F;
        function filtering(type, k, imageData) {
            if (&#x27;mono&#x27; === type) {
                return mono(k, imageData);
            }
            if (&#x27;grayscale&#x27; === type) {
                return grayscale(k, imageData);
            }
            if (&#x27;smooth&#x27; === type) {
                return smooth(k, imageData);
            }
        }

        &#x2F;**
         * フィルタ処理
         * @param {String} type フィルターの種類(mono | grayscale | smooth)
         * @param {Number} k ImageData.dataの処理rgbaのred値に対応するインデックス&lt;br&gt;
         * @param imageData
         * @return {Object} rgbaの値を格納したオブジェクト
         *&#x2F;
        function run(type, k, imageData) {
            return filtering(type, k , imageData);
        }

        filter.run = run;

    }());

    &#x2F;**
     * 画像処理を提供する
     *
     * @class processing
     *&#x2F;
    var processing = {};

    &#x2F;&#x2F; processing
    (function() {

        var imageData;

        &#x2F;&#x2F; 処理確認コンソール出力
        function print(rgba, i, j) {
            console.log(i + &#x27;行&#x27; + j + &#x27;列&#x27;);
            console.log(&#x27;Red : &#x27; + rgba.r);
            console.log(&#x27;Green : &#x27; + rgba.g);
            console.log(&#x27;Blue : &#x27; + rgba.b);
            console.log(&#x27;Alpha : &#x27; + rgba.a);
            console.log(&#x27;-- -- -- -- --&#x27;);
        }

        &#x2F;**
         * フィルター処理結果のRGBAデータ配列を返すを返す
         *
         * @method run
         * @param {String} type フィルターの種類(mono | grayscale | smooth)
         *&#x2F;
        function run(type) {
            &#x2F;&#x2F; 全てのピクセルを走査
            var i, j, k, rgba = {}, data = [];
            &#x2F;&#x2F; 行
            for (i = 0; i &lt; imageData.height; i++) {
                &#x2F;&#x2F; 列
                for (j = 0; j &lt; imageData.width; j++) {
                    k  = (i * imageData.width + j) * 4;
                    rgba = filter.run(type, k, imageData);
                    data[k] = rgba.r;
                    data[k + 1] = rgba.g;
                    data[k + 2] = rgba.b;
                    data[k + 3] = rgba.a;
                }
            }
            return data;
        }

        &#x2F;**
         * 初期化
         *
         * 処理対象のImageDataを設定する
         *
         * @method init
         * @param {ImageData} targetImageData
         *&#x2F;
        function init(targetImageData) {
            imageData = targetImageData;
        }

        &#x2F;&#x2F; 公開メソッド
        processing.run = run;
        processing.init = init;
    }());

    &#x2F;&#x2F; 下記カラー情報配列を作成
    &#x2F;&#x2F; 赤、緑、青
    &#x2F;&#x2F; シアン、マゼンダ、イエロー
    &#x2F;&#x2F; 黒、グレー、白
    var data = [
        &#x2F;&#x2F; 左上(赤)
        255, &#x2F;&#x2F; Red
        0,   &#x2F;&#x2F; Green
        0,   &#x2F;&#x2F; Blue
        255, &#x2F;&#x2F; Alpha
        &#x2F;&#x2F; 中上(緑)
        0,
        255,
        0,
        255,
        &#x2F;&#x2F; 右上(青)
        0,
        0,
        255,
        255,
        &#x2F;&#x2F; 中左(シアン)
        0,
        255,
        255,
        255,
        &#x2F;&#x2F; 中中(マゼンダ)
        255,
        0,
        255,
        255,
        &#x2F;&#x2F; 中右(イエロー)
        255,
        255,
        0,
        255,
        &#x2F;&#x2F; 下左(黒)
        0,
        0,
        0,
        255,
        &#x2F;&#x2F; 下中(グレー)
        128,
        128,
        128,
        255,
        &#x2F;&#x2F; 下右(白)
        255,
        255,
        255,
        255
    ];

    var canvas = $(&#x27;#canvas1&#x27;).get(0);
    canvas.width = 3;
    canvas.height = 3;
    var ctx = canvas.getContext(&#x27;2d&#x27;);
    var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    &#x2F;&#x2F; ImageDataに初期ピクセル情報設定
    imageData.data.set(data);
    processing.init(imageData);
    console.log(processing.run(&#x27;smooth&#x27;));
    &#x2F;&#x2F; フィルタ処理後のピクセル情報を設定
    imageData.data.set(processing.run(&#x27;smooth&#x27;));
    ctx.putImageData(imageData, 0, 0);
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
